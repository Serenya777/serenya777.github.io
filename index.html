<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dungeon Quest</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: #1a1a1a;
            color: white;
            font-family: Arial, sans-serif;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* –ü–∞–Ω–µ–ª—å –∏–≥—Ä–æ–∫–∞ */
        .player-info {
            background: #2c3e50;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        /* –ö–Ω–æ–ø–∫–∏ –ø–æ–¥–∑–µ–º–µ–ª–∏–π */
        .dungeons-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .dungeon-btn {
            background: #3498db;
            padding: 15px;
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .dungeon-btn:hover {
            transform: scale(1.05);
        }

        /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
        .item-card {
            background: #34495e;
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            animation: itemAppear 0.5s ease;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes itemAppear {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes levelUp {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .level-up {
            animation: levelUp 1s;
            color: #f1c40f;
        }

        /* –¢–æ—Ä–≥–æ–≤–∞—è –ø–ª–æ—â–∞–¥–∫–∞ */
        .trade-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
        }

        .trade-content {
            background: #2c3e50;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ü–∞–Ω–µ–ª—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ -->
        <div class="player-info">
            <div>
                <div>üî∞ –£—Ä–æ–≤–µ–Ω—å <span id="level">1</span></div>
                <div>‚ö° –û–ø—ã—Ç <span id="exp">0</span>/<span id="exp-needed">100</span></div>
            </div>
            <div>
                <div>‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ <span id="hp">100</span></div>
                <div>‚öîÔ∏è –£—Ä–æ–Ω <span id="damage">10</span></div>
            </div>
        </div>

        <!-- –ü–æ–¥–∑–µ–º–µ–ª—å—è -->
        <div class="dungeons-container">
            <button class="dungeon-btn" data-duration="1">üè∞ 1 —á–∞—Å</button>
            <button class="dungeon-btn" data-duration="2">üè∞ 2 —á–∞—Å–∞</button>
        </div>

        <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
        <div id="inventory">
            <h2>üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å <button onclick="openTrade()">üîÑ –û–±–º–µ–Ω</button></h2>
            <div id="items-list"></div>
        </div>

        <!-- –ú–æ–¥–∞–ª–∫–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏ -->
        <div class="trade-modal" id="tradeModal">
            <div class="trade-content">
                <h3>üé™ –¢–æ—Ä–≥–æ–≤–∞—è –ø–ª–æ—â–∞–¥–∫–∞</h3>
                <div id="trade-items"></div>
                <button onclick="confirmTrade()">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                <button onclick="closeTrade()">‚ùå –û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = {
            id: null,
            inventory: [],
            level: 1,
            exp: 0,
            stats: { hp: 100, damage: 10 }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            const savedData = localStorage.getItem('gameData');
            if(savedData) currentUser = JSON.parse(savedData);
            
            updateUI();
            initDungeons();
        });

        // –ü–æ–¥–∑–µ–º–µ–ª—å—è
        function initDungeons() {
            document.querySelectorAll('.dungeon-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const duration = parseInt(this.dataset.duration);
                    startDungeon(duration);
                });
            });
        }

        function startDungeon(duration) {
            // –°–∏–º—É–ª—è—Ü–∏—è –±–æ—è
            setTimeout(() => {
                const newItem = generateItem();
                currentUser.inventory.push(newItem);
                
                // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –æ–ø—ã—Ç–∞
                currentUser.exp += duration * 50;
                checkLevelUp();
                
                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                saveGame();
                updateUI();
                showResult(newItem);
            }, 1000);
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–¥–º–µ—Ç–∞
        function generateItem() {
            const prefixes = ['–†–∂–∞–≤—ã–π', '–ú–∏—Å—Ç–∏—á–µ—Å–∫–∏–π', '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π'];
            const types = ['–ú–µ—á', '–©–∏—Ç', '–®–ª–µ–º'];
            return {
                name: `${prefixes[Math.floor(Math.random()*3)]} ${types[Math.floor(Math.random()*3)]}`,
                stats: {
                    defense: Math.floor(Math.random()*20)+1,
                    damage: Math.floor(Math.random()*10)+1
                }
            };
        }

        // –°–∏—Å—Ç–µ–º–∞ —É—Ä–æ–≤–Ω–µ–π
        function checkLevelUp() {
            const needed = getExpToNextLevel(currentUser.level);
            
            while(currentUser.exp >= needed) {
                currentUser.exp -= needed;
                currentUser.level++;
                
                // –£–ª—É—á—à–µ–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
                currentUser.stats.hp += 20;
                currentUser.stats.damage += 5;
                
                // –ê–Ω–∏–º–∞—Ü–∏—è
                document.getElementById('level').classList.add('level-up');
                setTimeout(() => {
                    document.getElementById('level').classList.remove('level-up');
                }, 1000);
            }
        }

        function getExpToNextLevel(level) {
            return 100 * Math.pow(2, level-1);
        }

        // –¢–æ—Ä–≥–æ–≤–ª—è
        function openTrade() {
            document.getElementById('tradeModal').style.display = 'flex';
            // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤–ª–∏
        }

        function confirmTrade() {
            // –õ–æ–≥–∏–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–±–º–µ–Ω–∞
            closeTrade();
        }

        function closeTrade() {
            document.getElementById('tradeModal').style.display = 'none';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            document.getElementById('level').textContent = currentUser.level;
            document.getElementById('exp').textContent = currentUser.exp;
            document.getElementById('exp-needed').textContent = getExpToNextLevel(currentUser.level);
            document.getElementById('hp').textContent = currentUser.stats.hp;
            document.getElementById('damage').textContent = currentUser.stats.damage;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            const itemsList = document.getElementById('items-list');
            itemsList.innerHTML = currentUser.inventory.map(item => `
                <div class="item-card">
                    <div>${item.name}</div>
                    <div>üõ°Ô∏è${item.stats.defense} ‚öîÔ∏è${item.stats.damage}</div>
                </div>
            `).join('');
        }

        function showResult(item) {
            const resultHTML = `
                <div class="item-card" style="margin-top:20px;">
                    üéâ –ü–æ–ª—É—á–µ–Ω–æ: 
                    <b>${item.name}</b>
                    (üõ°Ô∏è${item.stats.defense} ‚öîÔ∏è${item.stats.damage})
                </div>
            `;
            document.getElementById('inventory').insertAdjacentHTML('beforeend', resultHTML);
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
        function saveGame() {
            localStorage.setItem('gameData', JSON.stringify(currentUser));
        }
    </script>
</body>
</html>
